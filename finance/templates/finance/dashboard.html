{% extends "finance/base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <h1 class="mb-4">Finance Dashboard</h1>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Income</h5>
                    <p class="card-text fs-4">{{ income_total }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-danger mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Expense</h5>
                    <p class="card-text fs-4">{{ expense_total }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Net</h5>
                    <p class="card-text fs-4">{{ net_total }}</p>
                </div>
            </div>
        </div>
    </div>

    <h2>Expenses by Category</h2>
    {% if expense_by_category %}
        <table class="table table-striped table-sm mb-4">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Total Expense</th>
                </tr>
            </thead>
            <tbody>
                {% for row in expense_by_category %}
                    <tr>
                        <td>{{ row.category__name }}</td>
                        <td>{{ row.total }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No expense data yet.</p>
    {% endif %}

    <h2>Income by Category</h2>
    {% if income_by_category %}
        <table class="table table-striped table-sm mb-4">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Total Income</th>
                </tr>
            </thead>
            <tbody>
                {% for row in income_by_category %}
                    <tr>
                        <td>{{ row.category__name }}</td>
                        <td>{{ row.total }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No income data yet.</p>
    {% endif %}

    <h2>Recent Transactions</h2>
    {% if transactions %}
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Account</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions %}
                    <tr>
                        <td>{{ t.date }}</td>
                        <td>{{ t.account.name }}</td>
                        <td>{{ t.category.name }}</td>
                        <td>{{ t.amount }}</td>
                        <td>
                            {% if t.is_income %}
                                Income
                            {% elif t.is_expense %}
                                Expense
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ t.description }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No transactions yet.</p>
    {% endif %}
{% endblock %}
